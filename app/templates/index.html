<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cyber Cafe Due Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <header class="bg-indigo-600 p-4 text-white shadow">
    <div class="container mx-auto text-center">
      <h1 class="text-3xl font-bold">Amit Cyber Cafe Due Tracker</h1>
    </div>
  </header>

  <main class="container mx-auto p-4">
    <div class="bg-white rounded shadow p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">Add New Customer</h2>
      <form id="customer-form" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <input type="text" id="name" placeholder="Name" required class="border p-2 rounded w-full" />
          <input type="text" id="phone" placeholder="Phone" required class="border p-2 rounded w-full" />
          <input type="email" id="email" placeholder="Email (optional)" class="border p-2 rounded w-full" />
        </div>
        <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Add Customer</button>
      </form>
    </div>

    <div class="bg-white rounded shadow p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">Add Due</h2>
      <form id="due-form" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <input type="number" id="customer_id" placeholder="Customer ID" required class="border p-2 rounded w-full" />
          <input type="number" id="amount" placeholder="Amount" required class="border p-2 rounded w-full" />
          <input type="date" id="due_date" required class="border p-2 rounded w-full" />
        </div>
        <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Add Due</button>
      </form>
    </div>

    <div class="bg-white rounded shadow p-6">
      <h2 class="text-xl font-semibold mb-4">All Dues</h2>
      <table class="min-w-full text-sm">
        <thead class="bg-gray-200">
          <tr>
            <th class="p-2 text-left">ID</th>
            <th class="p-2 text-left">Customer</th>
            <th class="p-2 text-left">Amount</th>
            <th class="p-2 text-left">Due Date</th>
            <th class="p-2 text-left">Status</th>
          </tr>
        </thead>
        <tbody id="due-table-body" class="bg-white">
        </tbody>
      </table>
    </div>
  </main>

  <script>
    document.getElementById('customer-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const phone = document.getElementById('phone').value;
      const email = document.getElementById('email').value;

      const res = await fetch('/customers/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, phone, email })
      });
      const data = await res.json();
      alert(data.message || 'Customer added!');
    });

    document.getElementById('due-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const customer_id = document.getElementById('customer_id').value;
      const amount = document.getElementById('amount').value;
      const due_date = document.getElementById('due_date').value;

      const res = await fetch('/dues/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ customer_id, amount, due_date })
      });
      const data = await res.json();
      alert(data.message || 'Due added!');
      loadDues();
    });

    async function loadDues() {
      const res = await fetch('/dues/');
      const dues = await res.json();
      const tbody = document.getElementById('due-table-body');
      tbody.innerHTML = '';
      dues.forEach(due => {
        tbody.innerHTML += `
          <tr class="border-b">
            <td class="p-2">${due.id}</td>
            <td class="p-2">${due.customer_name}</td>
            <td class="p-2">â‚¹${due.amount.toFixed(2)}</td>
            <td class="p-2">${due.due_date}</td>
            <td class="p-2">${due.status}</td>
          </tr>`;
      });
    }

    window.onload = loadDues;
  </script>
</body>
</html>
